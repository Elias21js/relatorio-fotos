import{T as t,c as v,a as m,q as f,w as g,b as y,j as p,e as w,k as I,l as L,d as B}from"./toast-BLSJKt5h.js";const o=document.getElementById("user"),r=document.getElementById("email"),d=document.getElementById("password"),U=()=>new Date().getFullYear(),q=()=>{const e=new Date;return e.getMonth()+1<10?`0${e.getMonth()+1}`:e.getMonth()+1};function h({value:e},{value:i}){return!e||e===""||!i||i===""}document.getElementById("auth-form").addEventListener("submit",e=>{e.preventDefault()});document.getElementById("btn-login").addEventListener("click",async()=>{if(h(o,d))return t.fire({icon:"warning",title:"Preencha todos os campos!"});try{const e=v(m,"usuarios"),i=f(e,g("user","==",o.value)),l=await y(i);if(l.empty)return t.fire({icon:"error",title:"Usuário não existe!"});const c=l.docs[0],u=c.data().email;await p(w,u,d.value),localStorage.setItem("userLoggedIn",JSON.stringify({uid:c.id,email:u,name:o.value})),t.fire({icon:"success",title:"Logado com sucesso!"}),setTimeout(()=>{window.location.href="/relatorio-fotos/index.html"},500)}catch(e){if(e.code==="auth/invalid-credential"||e.code==="auth/wrong-password")return t.fire({icon:"error",title:"Credenciais inválidas."});console.error("Erro ao fazer login:",e.message)}});const n=document.getElementById("btn-register"),E=n.querySelector(".btn-text"),b=n.querySelector(".spinner"),x=()=>{n.disabled=!0,E.style.visibility="hidden",b.style.display="inline-block"},s=()=>{n.disabled=!1,E.style.visibility="visible",b.style.display="none"};n.addEventListener("click",async()=>{if(h(o,d))return t.fire({icon:"warning",title:"Preencha o usuário e a senha!"});if(!r.value||r.value==="")return r.style.display="block",t.fire({icon:"error",title:"Insira um email!"});x();try{const e=v(m,"usuarios"),i=f(e,g("user","==",o.value)),l=f(e,g("email","==",r.value)),c=await y(i),u=await y(l);if(!c.empty)return s(),t.fire({icon:"error",title:"Usuário já existe."});if(!u.empty)return s(),t.fire({icon:"error",title:"Email já existe."});try{const a=await I(w,r.value,d.value);await L(B(m,"usuarios",a.user.uid),{user:o.value,email:r.value,data:{[`${U()}`]:{[`${q()}`]:{banca:[],vales:[],descontos:[]}}}}),r.style.display="none",s(),t.fire({icon:"success",title:"Registrado com sucesso."})}catch(a){if(a.code==="auth/email-already-in-use")return s(),t.fire({icon:"error",title:"Este e-mail já está registrado."});if(a.code==="auth/invalid-email")return s(),t.fire({icon:"error",title:"Formato de email inválido, use @gmail.com"});s(),console.error(a.message)}}catch{s()}});document.addEventListener("DOMContentLoaded",()=>{const e=JSON.parse(localStorage.getItem("userLoggedIn"))??!1;e&&e.uid&&(window.location.href="/relatorio-fotos/index.html")});
