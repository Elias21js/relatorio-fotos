import{T as t,c as v,a as m,q as f,w as g,b as y,i as p,e as h,j as I,k as L,d as B}from"./toast-_id9cDVe.js";const o=document.getElementById("user"),s=document.getElementById("email"),d=document.getElementById("password");function w({value:e},{value:r}){return!e||e===""||!r||r===""}document.getElementById("auth-form").addEventListener("submit",e=>{e.preventDefault()});document.getElementById("btn-login").addEventListener("click",async()=>{if(w(o,d))return t.fire({icon:"warning",title:"Preencha todos os campos!"});try{const e=v(m,"usuarios"),r=f(e,g("user","==",o.value)),a=await y(r);if(console.log(a),a.empty)return t.fire({icon:"error",title:"Usuário não existe!"});const c=a.docs[0],u=c.data().email;await p(h,u,d.value),localStorage.setItem("userLoggedIn",JSON.stringify({uid:c.id,email:u,name:o.value})),t.fire({icon:"success",title:"Logado com sucesso!"}),setTimeout(()=>{window.location.href="/relatorio-fotos/index.html"},500)}catch(e){if(e.code==="auth/invalid-credential"||e.code==="auth/wrong-password")return t.fire({icon:"error",title:"Credenciais inválidas."});console.error("Erro ao fazer login:",e.message)}});const l=document.getElementById("btn-register"),E=l.querySelector(".btn-text"),b=l.querySelector(".spinner"),U=()=>{l.disabled=!0,E.style.visibility="hidden",b.style.display="inline-block"},i=()=>{l.disabled=!1,E.style.visibility="visible",b.style.display="none"};l.addEventListener("click",async()=>{if(w(o,d))return t.fire({icon:"warning",title:"Preencha o usuário e a senha!"});if(!s.value||s.value==="")return s.style.display="block",t.fire({icon:"error",title:"Insira um email!"});U();try{const e=v(m,"usuarios"),r=f(e,g("user","==",o.value)),a=f(e,g("email","==",s.value)),c=await y(r),u=await y(a);if(!c.empty)return i(),t.fire({icon:"error",title:"Usuário já existe."});if(!u.empty)return i(),t.fire({icon:"error",title:"Email já existe."});try{const n=await I(h,s.value,d.value);await L(B(m,"usuarios",n.user.uid),{user:o.value,email:s.value,banca:[],vales:[],descontos:[]}),s.style.display="none",i(),t.fire({icon:"success",title:"Registrado com sucesso."})}catch(n){if(n.code==="auth/email-already-in-use")return i(),t.fire({icon:"error",title:"Este e-mail já está registrado."});if(n.code==="auth/invalid-email")return i(),t.fire({icon:"error",title:"Formato de email inválido, use @gmail.com"});i(),console.error(n.message)}}catch(e){i(),console.log("linha 158, auth.js",e.message)}});document.addEventListener("DOMContentLoaded",()=>{const e=JSON.parse(localStorage.getItem("userLoggedIn"))??!1;e&&e.uid&&(window.location.href="/relatorio-fotos/index.html")});
